##深入理解JAVA虚拟机 note##

###类文件结构###

- 实现语言无关性的基础是虚拟机和字节码的存储格式（.class文件）。
-  class文件是一组以8位字节为基础单位的二进制流。
-  class文件格式结构中只有两种数据类型：无符号数和表
-  每个class文件的头4个字节称为**魔数**，它的唯一作用是确定这个文件是否为一个能被虚拟机接受的class文件。不适用扩展名是因为扩展名可以随意改动。
-  紧接着的4个字节存储的是class文件的**版本号**。虚拟机拒绝执行超过其版本号的class文件
-  紧接着主次版本号之后的是**常量池**入口，是一个表类型数据项目。
-  常量池入口是一个常量池容量计数值。从1开始计数。
-  常量池主要存放字面量和符号引用。
-  java程序方法体中的代码经过javac编译器处理后，最终变为字节码指令存储在**Code属性**内。
-  每个指令是一个u1类型的单字节
-  虚拟机规范明确限制了一个方法不允许超过65535条字节码指令。一般java代码方法都不会超过这个限制，但某些特殊情况，在编译一个很复杂的JSP文件时，某些JSP编译器会把JSP内容和页面输出的信息归并于一个方法之中，就可能因为方法生成字节码超长的原因导致编译失败。
-  java虚拟机的指令有一个字节长度的、代表着某种特定操作含义的数字（操作码）以及跟随其后的零至多个代表此操作所需参数（操作数）而构成。大多数指令都不包含操作数，只有一个操作码。
-  加载和存储指令用于将数据在栈帧中的局部变量表和操作数栈之间来回传输。
-  运算或算数指令用于对两个操作数栈上的值进行某种特定运算，并将结果重新输入到操作栈顶。
-  class文件所具备的平台中立（不依赖于特定硬件及操作系统）、紧凑、稳定和可扩展的特点，是java技术体系实现平台无关、语言无关两项特性的重要支柱。


###虚拟机类加载机制###
> 
> 虚拟机把描述类的数据从class文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的java类型，这就是虚拟机的类加载机制。

- 与那些编译时需要进行连接工作的语言不同，java类型的加载、连接和初始化过程都是在程序运行期间完成的，虽然会增加性能开销，但是java里天生就可以动态扩展的语言特性就是依赖运行期动态加载和动态连接这个特点实现的。
- 212


###JAVA 内存区域###

- 栈帧(Stack Frame)是用于支持虚拟机进行方法调用和方法执行的数据结构，它是虚拟机运行时数据区的虚拟机栈(Virtual Machine Stack)的栈元素。栈帧存储了方法的局部变量表，操作数栈，动态连接和方法返回地址等信息。第一个方法从调用开始到执行完成，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。